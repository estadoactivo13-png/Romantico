<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Un Regalo Especial</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,400&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        :root {
            --oro: #d4af37;
            --blanco: #ffffff;
            --sombra: rgba(0, 0, 0, 0.8);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Poppins', sans-serif;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background-color: #000;
        }

        .bg-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), 
                        url('https://images.unsplash.com/photo-1516589174184-c6852657d403?q=80&w=2000') no-repeat center center;
            background-size: cover;
            z-index: -1;
        }

        /* DEDICATORIA */
        .dedicatoria-top {
            position: absolute;
            top: 5vh; left: 5vw;
            color: var(--blanco);
            border-left: 3px solid var(--oro);
            padding-left: 15px;
            z-index: 10;
        }
        .dedicatoria-top span { display: block; font-family: 'Playfair Display', serif; font-size: 1.5rem; color: var(--oro); }

        .main-content { text-align: center; color: white; z-index: 5; max-width: 800px; padding: 20px; }

        .foto-principal {
            width: 140px; height: 140px;
            border-radius: 50%; border: 3px solid var(--oro);
            margin: 0 auto 20px; object-fit: cover;
            box-shadow: 0 0 20px var(--oro);
            animation: floating 4s ease-in-out infinite;
            display: none;
        }

        .poema {
            font-family: 'Playfair Display', serif;
            font-size: 1.3rem; font-style: italic; margin-bottom: 25px;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.9);
        }

        #btnSobre {
            background: none; border: none; font-size: 4.5rem; cursor: pointer;
            filter: drop-shadow(0 0 15px var(--oro));
            animation: pulse 2s infinite; display: none;
        }

        /* MODALES */
        .modal {
            display: none; position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); backdrop-filter: blur(10px);
            z-index: 100; align-items: center; justify-content: center;
        }

        .modal-content {
            background: #fff; padding: 40px 30px; border-radius: 25px;
            width: 85%; max-width: 450px; text-align: center;
            border: 2px solid var(--oro); position: relative;
        }

        .modal-content h2 { font-family: 'Playfair Display', serif; color: var(--oro); margin-bottom: 15px; }
        .modal-content p { color: #444; font-size: 1rem; line-height: 1.6; }

        /* BOT√ìN PUBLICIDAD (PIE DE P√ÅGINA) */
        .footer-promo {
            position: fixed; bottom: 20px; width: 100%; text-align: center; z-index: 20;
        }

        .btn-promo {
            background: rgba(212, 175, 55, 0.2);
            color: var(--oro); border: 1px solid var(--oro);
            padding: 8px 15px; border-radius: 20px;
            font-size: 0.8rem; cursor: pointer; text-decoration: none;
            transition: 0.3s; backdrop-filter: blur(5px);
        }

        .btn-promo:hover { background: var(--oro); color: #000; }

        .btn-whatsapp {
            display: inline-block; margin-top: 20px; background: #25d366;
            color: white; padding: 10px 20px; border-radius: 10px;
            text-decoration: none; font-weight: bold;
        }

        .creditos { margin-top: 25px; font-size: 0.7rem; color: #888; border-top: 1px solid #eee; padding-top: 15px; }

        .close { position: absolute; top: 15px; right: 20px; font-size: 25px; cursor: pointer; color: #aaa; }

        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes floating { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    </style>
</head>
<body>

    <div class="bg-overlay"></div>

    <div class="dedicatoria-top" id="dedicatoria" style="display: none;">
        <p>PARA: <span id="txtPara">...</span></p>
        <p>DE: <span id="txtDe">...</span></p>
    </div>

    <div class="main-content">
        <img src="https://images.unsplash.com/photo-1518895949257-7621c3c786d7?q=80&w=500" class="foto-principal" id="foto">
        <div id="areaPoema">
            <h1 id="tituloMain" style="margin-bottom: 20px;">Escanear el QR de su tarjeta</h1>
            <p class="poema" id="poemaTexto" style="display: none;">
                "Porque los mejores detalles no se guardan en un caj√≥n, se llevan en el alma."
            </p>
        </div>
        <button id="btnSobre" onclick="accionSobre()">üíå</button>
    </div>

    <div class="footer-promo">
        <button class="btn-promo" onclick="abrirPromo()">‚ú® Crea tu propia c√°psula</button>
    </div>

    <div id="miModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarCaja()">&times;</span>
            <h2>Un mensaje para ti</h2>
            <p id="txtMensaje" style="font-style: italic;"></p>
        </div>
    </div>

    <div id="modalPromo" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarPromo()">&times;</span>
            <h2>Personaliza tu Regalo</h2>
            <p>¬øTe gustar√≠a regalar una experiencia digital como esta? Sorprende a esa persona especial con una c√°psula personalizada.</p>
            
            <a href="https://wa.me/TUNUMERO" class="btn-whatsapp" target="_blank">Contactar por WhatsApp</a>

            <div class="creditos">
                <p><strong>Cr√©ditos de la obra:</strong></p>
                <p>M√∫sica: [Nombre del autor o "Creaci√≥n propia"]</p>
                <p>Im√°genes: [Unsplash / Nombre del autor]</p>
                <p>Desarrollado con ‚ù§Ô∏è por TuNombre/Marca</p>
            </div>
        </div>
    </div>

    <audio id="musica" loop>
        <source src="musica.mp3" type="audio/mpeg">
    </audio>

    <script>
        const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTX9GbZ-VpQB2QgB8pkkwy4YvgN6qIqDSwvgTUmqyAVwGFqwEEK3fIPjxd09QxJtEuRXRzowvjCIEjo/pub?output=csv';
        let tieneMensaje = false;
        const audio = document.getElementById('musica');

        async function cargarDatos() {
            const params = new URLSearchParams(window.location.search);
            const idBuscado = params.get('id');
            if (!idBuscado) return;

            Papa.parse(csvUrl, {
                download: true,
                complete: function(results) {
                    const filas = results.data;
                    const fila = filas.find(f => f[1] && f[1].trim() === idBuscado.trim());
                    if (fila) {
                        document.getElementById('tituloMain').style.display = 'none';
                        document.getElementById('dedicatoria').style.display = 'block';
                        document.getElementById('poemaTexto').style.display = 'block';
                        document.getElementById('foto').style.display = 'block';
                        document.getElementById('btnSobre').style.display = 'inline-block';
                        document.getElementById('txtDe').innerText = fila[2] || "Alguien especial";
                        document.getElementById('txtPara').innerText = fila[4] || "Para ti";
                        const msg = fila[3] ? fila[3].trim() : "";
                        if (msg.length > 0) { tieneMensaje = true; document.getElementById('txtMensaje').innerText = msg; }
                    }
                }
            });
        }

        function accionSobre() {
            if (audio.paused) audio.play();
            else if (!tieneMensaje) audio.pause();
            if (tieneMensaje) document.getElementById('miModal').style.display = 'flex';
        }

        function cerrarCaja() { document.getElementById('miModal').style.display = 'none'; }
        
        function abrirPromo() { document.getElementById('modalPromo').style.display = 'flex'; }
        function cerrarPromo() { document.getElementById('modalPromo').style.display = 'none'; }

        window.onload = cargarDatos;
    </script>
</body>
</html>
